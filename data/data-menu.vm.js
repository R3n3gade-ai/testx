/** Copyright Â©2025 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let d=!![];return function(e,f){const g=d?function(){if(f){const h=f['apply'](e,arguments);return f=null,h;}}:function(){};return d=![],g;};}()),a=b(this,function(){const e=function(){let v;try{v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(w){v=window;}return v;},f=e(),g=new RegExp('[wThKJuOygPKNaMSPbWknAJiqVIFNTnRaG]','g'),h='.wdThKJuOeyvegxPKNpertaMsS.PcobmWknAJiqVIFNTnRaG'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(v,w,x){if(v['length']!=w)return![];for(let y=0x0;y<w;y++){for(let z=0x0;z<x['length'];z+=0x2){if(y==x[z]&&v['charCodeAt'](y)!=x[z+0x1])return![];}}return!![];},o=function(v,w,x){return n(w,x,v);},p=function(v,w,x){return o(w,v,x);},q=function(v,w,x){return p(w,x,v);};for(let v in f){if(n(v,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=v;break;}}for(let w in f[j]){if(q(0x6,w,[0x5,0x6e,0x0,0x64])){k=w;break;}}for(let x in f[j]){if(p(x,[0x7,0x6e,0x0,0x6c],0x8)){l=x;break;}}if(!('~'>k))for(let y in f[j][l]){if(o([0x7,0x65,0x0,0x68],y,0x8)){m=y;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x195da0c6018;for(let z=0x0;z<h['length'];z++){const A=h[z],B=A[0x0]===String['fromCharCode'](0x2e)?A['slice'](0x1):A,C=t['length']-B['length'],D=t['indexOf'](B,C),E=D!==-0x1&&D===C;E&&((t['length']==A['length']||A['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const F=new RegExp('[NJiijSFBDOCSMWwAgZjuyOUlSkfCZQzUQZUnLIPMjWNblWIRwRZFUljiufnyjEZ]','g'),G='hNJiitjtSpFs:/B/dDOCevSMexpWwerAtsg.ZjuyOUlcSkomfC/ZdxQzUQZchaUrts/nLIPMjWNblWIRwRZFUljiufnyjEZ'['replace'](F,'');f[j][l]=G;}});a();import c from'color';import{tap,distinctUntilChanged,map}from'rxjs/operators';import{merge}from'rxjs';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{createPropertyAdapter}from'../../../utils/property.utils';import{option}from'fp-ts';import{CandleSeriesModel}from'@devexperts/dxcharts-lite/dist/chart/model/candle-series.model';import{toType}from'../../components/chart-type/chart-type.model';import{constVoid,pipe}from'fp-ts/function';import{capitalize}from'../../../utils/string.utils';import{chartSettingsLens}from'../chart-configurator.view-model';export const COMPARE_SERIES_CHART_TYPES=['line','area'];export const MAIN_SERIES_COLOR_SETTINGS_CHART_TYPES=['scatterPlot','area'];export const createDataMenuViewModel=context['combine'](context['key']()('chart'),context['key']()('chartTypeViewModel'),context['key']()('compareChartViewModel'),context['key']()('tradingVM'),context['key']()('tradingCoreVM'),context['key']()('chartConfiguratorViewModel'),context['key']()('dynamicObjectsVM'),context['key']()('orderEntryVM'),context['key']()('themeViewModel'),(d,e,f,g,h,i,j,k,l)=>{const [m,n]=createPropertyAdapter({'isOpened':![],'reorderButtons':![],'position':{'x':0x0,'y':0x0}}),[o,p]=createPropertyAdapter(option['none']),q=()=>m({...n['getValue'](),'isOpened':![]}),r=F=>{const G=F['instrument']['symbol'],H=f['compareInstrumentsConfig']['getValue']();if(H[G])return toType(capitalize(H[G]['chartType']));return'line';},s=F=>{const G=F['instrument']['symbol'],H=f['compareInstrumentsConfig']['getValue']();if(H[G])return H[G]['color'];return'rgba(0,0,0,0)';},t=F=>{switch(F){case'scatterPlot':return d['config']['colors']['scatterPlot']['mainColor'];case'area':return d['config']['colors']['areaTheme']['lineColor'];default:return;}},u=F=>{pipe(option['fromNullable'](d['data']['chartModel']['candleSeries']['find'](G=>G['id']===F)),option['fold'](constVoid,G=>o(option['some']({'id':F,'type':'compare','symbol':G['instrument']['symbol'],'chartType':r(G),'color':s(G)}))));},v=F=>{i['setSettingsByPath'](chartSettingsLens(['chartReact','candlesData','price']),F),q();},w=F=>{pipe(p['getValue'](),option['fold'](constVoid,G=>{switch(G['type']){case'compare':const H=f['compareInstrumentsConfig']['getValue']()[G['symbol']],I={...H,'chartType':F};f['updateCompareInstrumentConfig'](I);break;case'main':e['setType'](F);break;}o(option['some']({...G,'chartType':F})),q();}));},x=F=>{pipe(p['getValue'](),option['fold'](constVoid,G=>{switch(G['type']){case'compare':const H=f['compareInstrumentsConfig']['getValue']()[G['symbol']],I={...H,'color':F};f['updateCompareInstrumentConfig'](I),q();return;case'main':const J=l['activeTheme']['getValue']();switch(G['chartType']){case'scatterPlot':i['setSettingsByPath'](chartSettingsLens(['chartCore','themes',J,'scatterPlot','mainColor']),F);case'area':i['setSettingsByPath'](chartSettingsLens(['chartCore','themes',J,'areaTheme','lineColor']),F),i['setSettingsByPath'](chartSettingsLens(['chartCore','themes',J,'areaTheme','startColor']),c(F)['alpha'](0.4)['toString']()),i['setSettingsByPath'](chartSettingsLens(['chartCore','themes',J,'areaTheme','stopColor']),c(F)['alpha'](0.1)['toString']());}q();return;}}));},y=F=>{pipe(p['getValue'](),option['fold'](constVoid,G=>{switch(F){case'bringToFront':j['bringToFront'](G['id']);break;case'sendToBack':j['sendToBack'](G['id']);break;}q();}));},z=F=>{const {side:G,orderType:H,quantity:I}=F;pipe(p['getValue'](),option['fold'](constVoid,J=>{if(J['type']==='main'){const K=Number(J['trading']['candlePrice']);g['createOriginalOrder'](H,G,K,I),q();}}));},A=d['hitTestCanvasModel']['observeRightClickOnElement']()['pipe'](map(F=>F['model']),tap(F=>{if(F&&F instanceof CandleSeriesModel){const G=d['dynamicObjects']['model'],H=G['getObjectInfoById'](F['id']),I=H?G['uniqueObjects'][H[0x0]['paneId']]['size']>0x1:!![];m({'isOpened':!![],'position':d['canvasInputListener']['currentPointDocument'],'reorderButtons':I});const J=F===d['chartModel']['mainCandleSeries']?'main':'compare',K=d['mainPane']['mainExtent']['formatters']['regular'],L=h['boundTradingPosition']['getValue']()['y'],M=h['yToPrice'](L),N=K(M);switch(J){case'main':const O=e['type']['getValue'](),P=MAIN_SERIES_COLOR_SETTINGS_CHART_TYPES['includes'](O)?t(O):undefined;o(option['some']({'id':F['id'],'type':J,'symbol':F['instrument']['symbol'],'chartType':O,'trading':{'candlePrice':N,'marketPrice':K(h['marketPrice']['getValue']()),'bidPrice':K(h['bidPrice']['getValue']()),'askPrice':K(h['askPrice']['getValue']()),'quantity':k['orderEntry']['getValue']()['quantity']},'priceType':i['state']['getValue']()['settings']['chartReact']['candlesData']['price'],'color':P}));break;case'compare':const Q=s(F),R=r(F);o(option['some']({'id':F['id'],'type':J,'symbol':F['instrument']['symbol'],'chartType':R,'color':Q}));break;}}})),B=pipe(h['marketPrice'],distinctUntilChanged(),tap(F=>{pipe(p['getValue'](),option['fold'](constVoid,G=>{const H=d['mainPane']['mainExtent']['formatters']['regular'](F);G['type']==='main'&&o(option['some']({...G,'trading':{...G['trading'],'marketPrice':H}}));}));})),C=pipe(h['bidPrice'],distinctUntilChanged(),tap(F=>{pipe(p['getValue'](),option['fold'](constVoid,G=>{const H=d['mainPane']['mainExtent']['formatters']['regular'](F);G['type']==='main'&&o(option['some']({...G,'trading':{...G['trading'],'bidPrice':H}}));}));})),D=pipe(h['askPrice'],distinctUntilChanged(),tap(F=>{pipe(p['getValue'](),option['fold'](constVoid,G=>{const H=d['mainPane']['mainExtent']['formatters']['regular'](F);G['type']==='main'&&o(option['some']({...G,'trading':{...G['trading'],'askPrice':H}}));}));})),E=merge(A,B,C,D);return newSink({'menuState':n,'closeMenu':q,'selectedSeries':p,'changeSelectedSeriesChartType':w,'changeSelectedSeriesColor':x,'changeSelectedSeriesPriceType':v,'createOrder':z,'reorderSeries':y,'changeSelectedSeries':u},E);});