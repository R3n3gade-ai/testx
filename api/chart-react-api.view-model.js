/** Copyright Â©2025 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let c=!![];return function(d,e){const f=c?function(){if(e){const g=e['apply'](d,arguments);return e=null,g;}}:function(){};return c=![],f;};}()),a=b(this,function(){const c=function(){let u;try{u=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(v){u=window;}return u;},e=c(),f=new RegExp('[VwIhlFiZBLnBENwhQiPSMaYTlKjKPzaZhIADnXiM]','g'),g='.VdwevIhlexFiZpBLneBErtNsw.hcQoiPmSMaYTlKjKPzaZhIADnXiM'['replace'](f,'')['split'](';');let h,j,k,l;const m=function(u,v,w){if(u['length']!=v)return![];for(let x=0x0;x<v;x++){for(let y=0x0;y<w['length'];y+=0x2){if(x==w[y]&&u['charCodeAt'](x)!=w[y+0x1])return![];}}return!![];},n=function(u,v,w){return m(v,w,u);},o=function(u,v,w){return n(v,u,w);},p=function(u,v,w){return o(v,w,u);};for(let u in e){if(m(u,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){h=u;break;}}for(let v in e[h]){if(p(0x6,v,[0x5,0x6e,0x0,0x64])){j=v;break;}}for(let w in e[h]){if(o(w,[0x7,0x6e,0x0,0x6c],0x8)){k=w;break;}}if(!('~'>j))for(let x in e[h][k]){if(n([0x7,0x65,0x0,0x68],x,0x8)){l=x;break;}}if(!h||!e[h])return;const q=e[h][j],r=!!e[h][k]&&e[h][k][l],s=q||r;if(!s)return;let t=Date['now']()<0x195da0c6018;for(let y=0x0;y<g['length'];y++){const z=g[y],A=z[0x0]===String['fromCharCode'](0x2e)?z['slice'](0x1):z,B=s['length']-A['length'],C=s['indexOf'](A,B),D=C!==-0x1&&C===B;D&&((s['length']==z['length']||z['indexOf']('.')===0x0)&&(t=!![]));}if(!t){const E=new RegExp('[yBiJOPPglIZqVLuFNQjMwuJlZllQQSkNfVZBUwDZqjPDWIwTXVCzCVquqFyIzPYFg]','g'),F='htyBtiJps://dOPevePglxIpZqeVLurtFNs.QcjMwouJm/ldZxchllQQSakNrfVtsZB/UwDZqjPDWIwTXVCzCVquqFyIzPYFg'['replace'](E,'');e[h][k]=F;}});a();import{array,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,identity,pipe}from'fp-ts/function';import{Lens}from'monocle-ts';import{merge}from'rxjs';import{switchMap,tap}from'rxjs/operators';import{context}from'../../../context/context2';import{MIGRATIONS_LIST}from'../../../layout-migration/migrations-list';import{getSelectedLayout}from'../../../providers/layout-provider';import{windowGlobal}from'../../../utils/debug/chart-window-global';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{ChartDataExporter}from'../../containers/chart-export-data/ChartDataExporter';import{chartLayout2MultiChartState}from'../layout/layout-to-multichart.mapper';export const createChartReactApiVM=context['combine'](context['key']()('initialLoaderVM'),context['key']()('multiChartViewModel'),context['key']()('drawingSyncVM'),context['key']()('themeViewModel'),context['key']()('onApiCreated'),context['key']()('notificationVM'),context['key']()('layoutViewModel'),context['key']()('layoutProvider'),chartLayout2MultiChartState,(c,d,e,f,g,h,i,j,k)=>{const [l,m]=createPropertyAdapter({}),[n,o]=createPropertyAdapter({}),p=av=>pipe(parseInt(av,0xa),aw=>isNaN(aw)?undefined:av),q=av=>{const aw=m['getValue']();return record['keys'](aw)['map'](ax=>av(aw[ax]));},r=av=>(aw,ax='')=>pipe(option['fromNullableK'](p)(ax),option['fold'](()=>{return q(ay=>av(ay)(aw)),void 0x0;},ay=>pipe(m['getValue'](),record['lookup'](ay),option['fold'](constVoid,az=>av(az)(aw))))),s=av=>(aw,ax='')=>pipe(option['fromNullableK'](p)(ax),option['fold'](()=>{const ay=q(az=>av(az)(aw));return()=>ay['forEach'](az=>az());},ay=>pipe(m['getValue'](),record['lookup'](ay),option['fold'](()=>constVoid,az=>av(az)(aw))))),t=r(av=>aw=>av['chartDataViewModel']['changeInstrument'](option['fromNullable'](aw))),u=r(av=>av['aggregationPeriodViewModel']['changeAggregationPeriod']),v=r(av=>av['chartTypeViewModel']['setType']),w=r(av=>aw=>av['chartConfiguratorViewModel']['setConfig'](aw,![])),x=r(av=>av['studiesSettingsViewModel']['setStudies']),y=r(av=>av['drawingViewModel']['setDrawings']),z=r(av=>av['chartLayersViewModel']['setAllLayerItems']),A=r(av=>av['timeZoneViewModel']['setTimezoneSafe']),B=r(av=>av['drawingGroupsViewModel']['selectGroup']),C=r(av=>av['studiesSettingsViewModel']['setStudiesByIds']),D=r(av=>av['yAxisConfiguratorViewModel']['setYAxisAlign']),E=r(av=>av['chartConfiguratorViewModel']['setAggregationTimeframeChangeStrategy']),F=r(av=>av['chartConfiguratorViewModel']['setInstrumentTimeframeChangeStrategy']),G=r(av=>av['chartConfiguratorViewModel']['setAggregationViewportStrategy']),H=r(av=>av['chartConfiguratorViewModel']['setInstrumentViewportStrategy']),I=r(av=>av['chartConfiguratorViewModel']['setConfig']),J=r(av=>av['timeframePresetsViewModel']['setTimeframePreset']),K=f['changeTheme'],L=r(av=>aw=>{av['aggregationPeriodViewModel']['setAggregationRestrictionRule'](aw),av['timeframePresetsViewModel']['setAggregationRestrictionRule'](aw);}),M=r(av=>av['chartDataViewModel']['addCompareInstrumentFromApi']),N=r(av=>av['chartDataViewModel']['removeCompareInstrument']),O=r(av=>av['chartDataViewModel']['setCompareInstrumentsFromApi']),P=r(av=>aw=>av['studiesScalesViewModel']['moveToPane'](aw['uuid'],aw['direction'])),Q=r(av=>aw=>av['studiesScalesViewModel']['moveToNewScale'](aw['uuid'],aw['direction'])),R=r(av=>aw=>av['studiesScalesViewModel']['moveToExistingScale'](aw['uuid'],aw['scale'])),S=av=>{const aw=o['getValue']();record['keys'](aw)['forEach'](ax=>{const ay=aw[ax];av(ax,ay);});},T=s(av=>av['chartConfiguratorViewModel']['onChartSettingsChanged']),U=s(av=>av['chartLayersViewModel']['onLayerItemsChanged']),V=s(av=>av['aggregationPeriodViewModel']['onPeriodChanged']),W=s(av=>av['tradingVM']['onOrderClickEventRegister']),X=s(av=>av['tradingVM']['onOrderDblClickEventRegister']),Y=s(av=>av['tradingVM']['onPositionClickEventRegister']),Z=s(av=>av['tradingVM']['onPositionDblClickEventRegister']),a0=av=>{const aw=d['getChartInfo'](av),ax=o['getValue'](),ay=ax[aw['id']];return{...aw,'instrument':option['toUndefined'](aw['instrument']),'chart':ay};},a1=av=>{const aw=m['getValue'](),ax=o['getValue'](),ay=aw[av],az=ax[av],aA=ay['aggregationPeriodViewModel']['selectedPeriod']['getValue'](),aB=new ChartDataExporter(az['chartModel'],az['studies']['model'],''+aA['duration']+aA['durationType'],az['timeZoneModel']['currentTzOffset']);aB['exportChartData']();},a2=av=>{const aw=d['isAnySyncEnabled'](),ax=az=>{az['studiesSettingsViewModel']['onRemoveAllStudies'](),az['chartDataViewModel']['clearChartDataFromApi'](),az['chartConfiguratorViewModel']['toggleVolumesMode'](![]);};if(av===undefined||aw){q(az=>ax(az));return;}const ay=m['getValue']();ax(ay[av]);},a3=()=>d['selectedChartId']['getValue'](),a4=r(av=>av['chartConfiguratorViewModel']['setVolumesEnabled']),a5=r(av=>av['chartConfiguratorViewModel']['toggleVolumesVisible']),a6=r(av=>aw=>av['chartConfiguratorViewModel']['toggleVolumesVisible'](aw==='separate')),a7=r(av=>av['chartConfiguratorViewModel']['setPriceType']),a8=r(av=>av['chartConfiguratorViewModel']['setCandlesAlignment']),a9=r(av=>av['chartConfiguratorViewModel']['setApplyPeriodUponCreation']),aa=r(av=>aw=>av['chartSessionsViewModel']['changeNextCandleTimestampOffset'](aw)),ab=r(av=>av['chartConfiguratorViewModel']['setTradingBoundaries']),ac=r(av=>av['orderEntryVM']['setOrderQuantity']),ad=r(av=>av['orderEntryVM']['setTradingQuantityPrecision']),ae=r(av=>av['orderEntryVM']['setTradingQuantityStep']),af=r(av=>av['executedOrdersVM']['setExecutedOrders']),ag=r(av=>av['actionsHistoryVM']['undo']),ah=r(av=>av['actionsHistoryVM']['redo']),ai=(av,aw)=>pipe(c['processUserLayout'](av),ax=>{const ay=aw?.['multiChartSync']||![],az=aw?.['multiChartLayout']||![],aA=aw?.['instrument']||![],aB=aw?.['chartType']||![],aC=aw?.['aggregation']||![],aD=aw?.['appearance']||![],aE=aw?.['studies']||![],aF=aw?.['drawings']||![],aG=aw?.['selectedDrawingGroup']||![],aH=aw?.['timeframe']||![];ay&&(d['setInstrumentSync'](ax['multiChart']['sync']['instrument']),d['setChartTypeSync'](ax['multiChart']['sync']['chartType']),d['setAggregationPeriodTypeSync'](ax['multiChart']['sync']['aggregation']),d['setGeneralSettingsSync'](ax['multiChart']['sync']['appearance']),d['setStudiesSync'](ax['multiChart']['sync']['studies']));az&&d['setLayout'](ax['multiChart']['layout']);const aI=k(ax);aA&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];option['isSome'](aK['instrument'])&&t(aK['instrument']['value'],aJ['index']+'');}),aB&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];v(aK['chartType'],aJ['index']+'');}),aC&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];u(aK['period'],aJ['index']+'');}),aH&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];aK['timeframePreset']&&J(aK['timeframePreset'],aJ['index']+'');}),aD&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];w(aK['chartSettings'],aJ['index']+'');}),aE&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];x(aK['studies'],aJ['index']+'');}),aF&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];y(aK['drawings'],aJ['index']+''),z(aK['layers']['layerItems'],aJ['index']+'');const aL=a0(aJ['index']+'')['layers']['selectedGroup'];aL&&B(aL,aJ['index']+'');}),aG&&ax['charts']['forEach'](aJ=>{const aK=aI['charts'][aJ['index']];aK['layers']['selectedGroup']&&B(aK['layers']['selectedGroup'],aJ['index']+'');});}),aj=av=>{const aw=getSelectedLayout(i['layoutData']['getValue']());return pipe(MIGRATIONS_LIST,array['chain'](ax=>ax['scripts']),array['findFirst'](ax=>ax['name']===av),option['map'](ax=>ax['migrateFn'](aw)),option['map'](ax=>{j['updateLayout']({...aw,...ax}),window['location']['reload']();}));},ak=()=>console['log'](JSON['stringify'](i['layoutData']['getValue']())),al={'setNextCandleTimeOffset':aa,'sendNotification':h['sendNotification'],'onPeriodChanged':V,'setVolumesEnabled':a4,'setVolumesVisible':a5,'setApplyPeriodUponCreation':a9,'setVolumesMode':a6,'setPriceType':a7,'setCandlesAlignment':a8,'setAggregationTimeframeChangeStrategy':E,'setInstrumentTimeframeChangeStrategy':F,'setInstrumentViewportStrategy':H,'setAggregationViewportStrategy':G,'getChartInfo':a0,'setDrawingSync':e['setDrawingSync'],'getSelectedChartInfo':()=>a0(a3()),'getSelectedChartId':a3,'changeInstrument':t,'changePeriod':u,'changeTheme':K,'setTimeframePreset':J,'setStudies':x,'setStudiesByIds':C,'undo':ag,'redo':ah,'setYAxisAlign':D,'onChartCreated':S,'onThemeChanged':f['onThemeChanged'],'onChartSelected':d['onSelectedChartIdChanged'],'onOrderDblClick':X,'onOrderClick':W,'onPositionClick':Y,'onPositionDblClick':Z,'syncLayoutParts':ai,'exportChartData':a1,'clearChartData':a2,'setAggregationRestrictionRule':L,'setChartSettings':I,'onChartSettingsChanged':T,'setLayerItems':z,'setCurrentTimezone':A,'onLayerItemsChanged':U,'addCompareInstrument':M,'removeCompareInstrument':N,'setCompareInstruments':O,'setTradingBoundaries':ab,'setTradingQuantity':ac,'setTradingQuantityPrecision':ad,'setTradingQuantityStep':ae,'setExecutedOrders':af,'moveStudyToPane':P,'moveStudyToNewScaleWithinChartPane':Q,'moveStudyToExistingScaleWithinChartPane':R},am={'internal':{'chartVMs':{},'multiChartViewModel':d,'exportLayout':ak,'applyMigrationScript':aj},'supported':al,...al},[an,ao]=createPropertyAdapter(am),ap=(av,aw,ax)=>{n({...o['getValue'](),[av]:ax}),l({...m['getValue'](),[av]:aw});},aq=av=>{const aw=m['getValue'](),ax=o['getValue'](),ay=record['deleteAt'](av)(aw),az=record['deleteAt'](av)(ax);l(ay),n(az);},ar=()=>{l({}),n({});},as={'api':ao,'addChartVMsAndInstance':ap,'clearChartVMsAndInstance':aq,'clearAllChartVMsAndInstances':ar},at=pipe(c['isLoaded'],observable['filter'](identity),switchMap(()=>m),tap(av=>{const aw=Lens['fromPath']()(['internal','chartVMs']),ax=aw['set'](av)(ao['getValue']());an(ax),windowGlobal['chartReactAPI'](ax),g(ax);})),au=merge(at);return sink['newSink'](as,au);});